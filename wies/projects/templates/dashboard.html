{% extends "base.html" %}
{% load static %}

{% block content %}

<!-- Page Header -->
<div class="rvo-layout-column rvo-layout-gap--xs rvo-layout-margin-bottom--md rvo-margin-block-end--md">
  <h1 class="utrecht-heading-1 rvo-heading--no-margins">
    WIES
  </h1>
  <span class="rvo-text--subtle">
    Wie, wat, waar, wanneer
  </span>
</div>

<!-- Statistics Cards -->
<div class="rvo-max-width-layout rvo-max-width-layout--md rvo-margin-block-end--md">
  <div class="rvo-layout-grid rvo-layout-gap--md rvo-layout-grid-columns--three">
    <div class="rvo-card rvo-card--outline rvo-card--padding-md">
      <div class="rvo-card__content">
        <span class="utrecht-icon rvo-icon rvo-icon-man-met-laptop rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Consultants op opdracht"></span>
        <h4 class="utrecht-heading-4 rvo-heading--no-margins">Consultants op opdracht</h4>
        {{ consultants_working }}
      </div>
    </div>
    <div class="rvo-card rvo-card--outline rvo-card--padding-md">
      <div class="rvo-card__content">
        <span class="utrecht-icon rvo-icon rvo-icon-basis-kantoorgebouw rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Aantal opdrachtgevers"></span>
        <h4 class="utrecht-heading-4 rvo-heading--no-margins">Aantal opdrachtgevers</h4>
        {{ total_clients_count }}
      </div>
    </div>
    <div class="rvo-card rvo-card--outline rvo-card--padding-md">
      <div class="rvo-card__content">
        <span class="utrecht-icon rvo-icon rvo-icon-budget rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Totale omzet"></span>
        <h4 class="utrecht-heading-4 rvo-heading--no-margins">Totale omzet</h4>
        â‚¬ {{ formatted_budget }}
      </div>
    </div>
  </div>
</div>

<!-- Dashboard Tabs -->
<div class="rvo-layout-column rvo-layout-gap--xl">
  <ul class="rvo-tabs rvo-ul rvo-ul--no-margin rvo-ul--no-padding rvo-ul--icon rvo-ul--icon-option-2" role="tablist" aria-label="Dashboard Tabs">
    <li role="presentation" class="rvo-tabs__item">
      <a href="#" class="rvo-link rvo-tabs__item-link {% if active_tab == 'ending_soon' %}rvo-tabs__item-link--active rvo-link--active{% endif %} rvo-link--no-underline" role="tab" aria-selected="{% if active_tab == 'ending_soon' %}true{% else %}false{% endif %}" onclick="showTab('ending_soon')">
        Opdrachten die binnenkort aflopen
      </a>
    </li>
    <li role="presentation" class="rvo-tabs__item">
      <a href="#" class="rvo-link rvo-tabs__item-link {% if active_tab == 'consultants_bench' %}rvo-tabs__item-link--active rvo-link--active{% endif %} rvo-link--no-underline" role="tab" aria-selected="{% if active_tab == 'consultants_bench' %}true{% else %}false{% endif %}" onclick="showTab('consultants_bench')">
        Consultants op bank
      </a>
    </li>
    <li role="presentation" class="rvo-tabs__item">
      <a href="#" class="rvo-link rvo-tabs__item-link {% if active_tab == 'new_leads' %}rvo-tabs__item-link--active rvo-link--active{% endif %} rvo-link--no-underline" role="tab" aria-selected="{% if active_tab == 'new_leads' %}true{% else %}false{% endif %}" onclick="showTab('new_leads')">
        Nieuwe leads
      </a>
    </li>
  </ul>

  <!-- Tab Content -->
  <div id="tab-content">
    
    <!-- Assignments ending soon (within 3 months) -->
    <div id="ending_soon" class="tab-content {% if active_tab != 'ending_soon' %}hidden{% endif %}">
      <div class="rvo-table--responsive">
        <table class="rvo-table">
          <thead class="rvo-table-head">
            <tr class="rvo-table-row">
              <th scope="col" class="rvo-table-header">Opdracht</th>
              <th scope="col" class="rvo-table-header">Opdrachtgever</th>
              <th scope="col" class="rvo-table-header">Einddatum</th>
              <th scope="col" class="rvo-table-header">Status</th>
            </tr>
          </thead>
          <tbody class="rvo-table-body">
            {% for assignment in assignments_ending_soon %}
            <tr class="rvo-table-row clickable-row" style="cursor: pointer;" onclick="window.location='{% url 'assignment-detail' assignment.pk %}'">
              <td class="rvo-table-cell">
                <a href="{% url 'assignment-detail' assignment.pk %}" class="rvo-link rvo-link--no-underline" onclick="event.stopPropagation()">{{ assignment.name }}</a>
              </td>
              <td class="rvo-table-cell">{{ assignment.organization }}</td>
              <td class="rvo-table-cell">{{ assignment.end_date|date:"d M Y" }}</td>
              <td class="rvo-table-cell">
                <span class="status-badge status-{{ assignment.status|lower }}">{{ assignment.status }}</span>
              </td>
            </tr>
            {% empty %}
            <tr class="rvo-table-row">
              <td class="rvo-table-cell" colspan="5" style="text-align: center; padding: 2rem;">
                <span class="rvo-text--italic">Geen opdrachten die binnenkort aflopen</span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Consultants on bench -->
    <div id="consultants_bench" class="tab-content {% if active_tab != 'consultants_bench' %}hidden{% endif %}">
      <div class="rvo-table--responsive">
        <table class="rvo-table">
          <thead class="rvo-table-head">
            <tr class="rvo-table-row">
              <th scope="col" class="rvo-table-header">Naam</th>
              <th scope="col" class="rvo-table-header">Merk</th>
              <th scope="col" class="rvo-table-header">Rollen</th>
              <th scope="col" class="rvo-table-header">Beschikbaar sinds</th>
            </tr>
          </thead>
          <tbody class="rvo-table-body">
            {% for colleague in consultants_bench %}
            <tr class="rvo-table-row clickable-row" style="cursor: pointer;" onclick="window.location='{% url 'colleague-detail' colleague.pk %}'">
              <td class="rvo-table-cell">
                <a href="{% url 'colleague-detail' colleague.pk %}" class="rvo-link rvo-link--no-underline" onclick="event.stopPropagation()">{{ colleague.name }}</a>
              </td>
              <td class="rvo-table-cell">
                {% if colleague.brand %}{{ colleague.brand.name }}{% else %}<span class="rvo-text--italic">-</span>{% endif %}
              </td>
              <td class="rvo-table-cell">
                {% for skill in colleague.skills.all %}
                  <span class="skill-badge">{{ skill.name }}</span>
                {% endfor %}
              </td>
              <td class="rvo-table-cell">-</td>
            </tr>
            {% empty %}
            <tr class="rvo-table-row">
              <td class="rvo-table-cell" colspan="5" style="text-align: center; padding: 2rem;">
                <span class="rvo-text--italic">Geen consultants op de bank</span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- New leads -->
    <div id="new_leads" class="tab-content {% if active_tab != 'new_leads' %}hidden{% endif %}">
      <div class="rvo-table--responsive">
        <table class="rvo-table">
          <thead class="rvo-table-head">
            <tr class="rvo-table-row">
              <th scope="col" class="rvo-table-header">Opdracht</th>
              <th scope="col" class="rvo-table-header">Opdrachtgever</th>
              <th scope="col" class="rvo-table-header">Status</th>
              <th scope="col" class="rvo-table-header">Startdatum</th>
            </tr>
          </thead>
          <tbody class="rvo-table-body">
            {% for assignment in new_leads %}
            <tr class="rvo-table-row clickable-row" style="cursor: pointer;" onclick="window.location='{% url 'assignment-detail' assignment.pk %}'">
              <td class="rvo-table-cell">
                <a href="{% url 'assignment-detail' assignment.pk %}" class="rvo-link rvo-link--no-underline" onclick="event.stopPropagation()">{{ assignment.name }}</a>
              </td>
              <td class="rvo-table-cell">{{ assignment.organization }}</td>
              <td class="rvo-table-cell">
                <span class="status-badge status-{{ assignment.status|lower }}">{{ assignment.status }}</span>
              </td>
              <td class="rvo-table-cell">{{ assignment.start_date|date:"d M Y"|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr class="rvo-table-row">
              <td class="rvo-table-cell" colspan="5" style="text-align: center; padding: 2rem;">
                <span class="rvo-text--italic">Geen nieuwe leads</span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
function showTab(tabName) {
  // Hide all tab contents
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.add('hidden');
  });
  
  // Remove active class from all tabs
  document.querySelectorAll('.rvo-tabs__item-link').forEach(link => {
    link.classList.remove('rvo-tabs__item-link--active', 'rvo-link--active');
  });
  
  // Show selected tab
  document.getElementById(tabName).classList.remove('hidden');
  
  // Add active class to clicked tab
  event.target.classList.add('rvo-tabs__item-link--active', 'rvo-link--active');
}
</script>

<style>
.hidden {
  display: none;
}
</style>

{% endblock content %}