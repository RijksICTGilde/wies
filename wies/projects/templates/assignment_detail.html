{% extends "base.html" %}

{% block content %}
<div class="rvo-layout-column rvo-layout-gap--sm">
  <div>
        <!-- Breadcrumbs -->
        <ol class="rvo-breadcrumbs rvo-breadcrumbs--sm">
          <li class="rvo-breadcrumbs-item">
            <a href="/assignments/" class="rvo-link rvo-link--no-underline">Opdrachten</a>
          </li>
          <li class="rvo-breadcrumbs-item">
            <span class="utrecht-icon rvo-icon rvo-icon-delta-naar-rechts rvo-icon--xs rvo-icon--hemelblauw" role="img" aria-label="Delta naar rechts"></span>
            <span class="rvo-breadcrumb-current-page">{{ object.name }}</span>
          </li>
        </ol>
    <div class="rvo-layout-row rvo-layout-gap--md rvo-layout-justify--space-between rvo-layout-align--end">
      <div>
        <h1 class="utrecht-heading-1 rvo-heading--no-margins">{{ object.name }}</h1>
      </div>
      <div class="rvo-layout-row rvo-layout-gap--md">
        <a href="/assignments/{{ object.pk }}/update" class="utrecht-button utrecht-button--secondary-action utrecht-button--rvo-sm">
          Opdracht bewerken
        </a>
        <a href="/assignments/{{ object.pk }}/delete" class="utrecht-button utrecht-button--subtle utrecht-button--warning utrecht-button--rvo-sm">
          Opdracht verwijderen
        </a>
      </div>
    </div>
  </div>
  
  <!-- Aanvraagperiode en budget -->
  <div class="rvo-custom-aanvraagperiode-budget">
    <div class="rvo-card rvo-card--outline rvo-card--padding-lg rvo-margin-block-start--xl">
      <div class="rvo-card__content">
        <div class="rvo-layout-grid rvo-layout-gap--md rvo-layout-grid-columns--two rvo-margin-block-end--lg">
          <div>
            <span class="utrecht-icon rvo-icon rvo-icon-kalender rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Kalender"></span>
            <br />
            <strong>Periode:</strong>
            <br />
            {% if object.start_date and object.end_date %}
              {{ object.start_date|date:"j M Y" }} - {{ object.end_date|date:"j M Y" }}
            {% elif object.start_date %}
              Vanaf {{ object.start_date|date:"j M Y" }}
            {% elif object.end_date %}
              Tot {{ object.end_date|date:"j M Y" }}
            {% else %}
              <span class="rvo-text--italic">Geen periode opgegeven</span>
            {% endif %}
          </div>
          <div>
            <span class="utrecht-icon rvo-icon rvo-icon-stapel-munten rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Stapel munten"></span>
            <br />
            <strong>Budget:</strong>
            <br />
            {% with total_cost=object.get_total_services_cost %}
              {% if total_cost %}
                € {{ total_cost|format_currency }}
              {% else %}
                € 0
              {% endif %}
            {% endwith %}
          </div>
          <div>
            <span class="utrecht-icon rvo-icon rvo-icon-zak-met-geld rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Zak met geld"></span>
            <br />
            <strong>Opdrachtgever:</strong>
            <br />
            {{ object.organization }}
          </div>
          <div>
            <span class="utrecht-icon rvo-icon rvo-icon-info rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Info"></span>
            <br />
            <strong>Ministerie:</strong>
            <br />
            {% if object.ministry %}
              {{ object.ministry.name }}
            {% else %}
              <span class="rvo-text--italic">Geen ministerie</span>
            {% endif %}
          </div>
          <div>
            <span class="utrecht-icon rvo-icon rvo-icon-tekst rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Tekst"></span>
            <br />
            <strong>Omschrijving:</strong>
            <br />
            {{ object.extra_info|default:"Geen omschrijving" }}
          </div>
          <div>
            <span class="utrecht-icon rvo-icon rvo-icon-vinkje rvo-icon--2xl rvo-icon--hemelblauw" role="img" aria-label="Vinkje"></span>
            <br />
            <strong>Status:</strong>
            <br />
            <span class="rvo-tag status-{{ object.status|lower }}">{{ object.status }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="rvo-layout-column rvo-layout-gap--sm">

    <h2 class="utrecht-heading-2 rvo-heading--no-margins">Diensten</h2>

    <!-- Service Cards -->
    {% for service in object.services.all %}
    <div class="rvo-card rvo-card--outline rvo-card--padding-lg rvo-margin-block-start--sm rvo-card--full-colour--grijs-100">
      <div class="rvo-card__content">
        <div class="rvo-layout-row rvo-layout-gap--md rvo-layout-justify--space-between rvo-margin-block-end--md">
          <h3 class="utrecht-heading-3 rvo-heading--no-margins">{{ service.description }}</h3>
          <div class="rvo-layout-row rvo-layout-gap--sm">
            <a href="/services/{{ service.id }}/update" class="utrecht-button utrecht-button--secondary-action utrecht-button--rvo-sm">Bewerken</a>
            <a href="/services/{{ service.id }}/delete" class="utrecht-button utrecht-button--subtle utrecht-button--warning utrecht-button--rvo-sm">Verwijderen</a>
          </div>
        </div>
        
        <div class="rvo-layout-grid rvo-layout-gap--md rvo-layout-grid-columns--four rvo-margin-block-end--lg">
          <div>
            <strong>Rol:</strong><br />
            {% if service.skill %}
              <span class="rvo-tag">{{ service.skill.name }}</span>
            {% else %}
              <span class="rvo-text--italic">Geen rol opgegeven</span>
            {% endif %}
          </div>
          <div>
            <strong>Periode:</strong><br />
            {% if service.start_date and service.end_date %}
              {{ service.start_date|date:"j M Y" }} - {{ service.end_date|date:"j M Y" }}
            {% elif service.start_date %}
              Vanaf {{ service.start_date|date:"j M Y" }}
            {% elif service.end_date %}
              Tot {{ service.end_date|date:"j M Y" }}
            {% else %}
              <span class="rvo-text--italic">Geen periode opgegeven</span>
            {% endif %}
          </div>
          <div>
            <strong>Kosten:</strong><br />
            {% if service.cost_type == "FIXED_PRICE" %}
              €{{ service.fixed_cost|format_currency }}
            {% elif service.cost_type == "PER_HOUR" %}
              {% with total_cost=service.get_total_cost weeks=service.get_weeks %}
                {% if total_cost %}
                  €{{ total_cost|format_currency }}
                  <br><small style="color: #666; font-size: 0.8em;">{{ weeks }} weken × {{ service.hours_per_week }} uur × €100</small>
                {% else %}
                  <span class="rvo-text--italic">Niet beschikbaar</span>
                {% endif %}
              {% endwith %}
            {% endif %}
          </div>
          <div>
            <strong>Inzet:</strong><br />
            {% if service.placements.all %}
              {{ service.placements.count }} personen
            {% else %}
              <span class="rvo-text--italic">Geen inzet</span>
            {% endif %}
          </div>
        </div>

        <!-- Placements within service -->
        {% if service.placements.all %}
        <div class="rvo-margin-block-start--md">
          <h4 class="utrecht-heading-4 rvo-margin-block-end--sm">Ingezette personen:</h4>
          <div class="rvo-layout-column rvo-layout-gap--sm">
            {% for placement in service.placements.all %}
            <div class="rvo-card rvo-card--outline rvo-card--padding-md rvo-card--full-colour--wit">
              <div class="rvo-layout-grid rvo-layout-gap--md rvo-layout-grid-columns--five">
                <div>
                  <strong>Persoon:</strong><br />
                  {% if placement.colleague %}
                    <a href="{% url 'colleague-detail' placement.colleague.pk %}" class="rvo-link">{{ placement.colleague.name }}</a>
                  {% else %}
                    <span class="rvo-text--italic">Nog niet toegewezen</span>
                  {% endif %}
                </div>
                <div>
                  <strong>Start:</strong><br />
                  {{ placement.start_date|default:"Niet opgegeven" }}
                </div>
                <div>
                  <strong>Eind:</strong><br />
                  {{ placement.end_date|default:"Niet opgegeven" }}
                </div>
                <div>
                  <strong>Uren/week:</strong><br />
                  {{ placement.hours_per_week|default:"Niet opgegeven" }}
                </div>
                <div>
                  <div class="rvo-layout-row rvo-layout-gap--sm">
                    <a href="/placements/{{ placement.id }}/update" class="utrecht-button utrecht-button--secondary-action utrecht-button--rvo-sm">Bewerken</a>
                    <a href="/placements/{{ placement.id }}/delete" class="utrecht-button utrecht-button--subtle utrecht-button--warning utrecht-button--rvo-sm">Verwijderen</a>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Add placement button -->
        <div class="rvo-margin-block-start--md">
          <a href="/assignments/{{ object.pk }}/placements/new?service={{ service.id }}" class="utrecht-button utrecht-button--secondary-action utrecht-button--rvo-sm">
            <span class="utrecht-icon rvo-icon rvo-icon-plus rvo-icon--md" role="img" aria-label="Plus"></span>
            Persoon toevoegen
          </a>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="rvo-paragraph rvo-text--italic">Nog geen diensten toegevoegd.</p>
    {% endfor %}

    <!-- Add service button -->
    <a href="/assignments/{{ object.pk }}/services/new" class="utrecht-button utrecht-button--primary-action utrecht-button--rvo-md">
      Dienst toevoegen
    </a>
  </div>
</div>
{% endblock content %}