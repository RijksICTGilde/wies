<script>
  // Filter Modal Functions
  function openFilterModal() {
    const modal = document.getElementById('filterModal');
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }

  function closeFilterModal() {
    const modal = document.getElementById('filterModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  function applyFilters() {
    const form = document.getElementById('modalFilterForm');
    const mainForm = document.querySelector('.rvo-form');
    
    // Copy values from modal form to main form
    const modalInputs = form.querySelectorAll('select, input');
    modalInputs.forEach(input => {
      if (input.value) {
        // Create or update hidden input for this filter
        let hiddenInput = mainForm.querySelector(`input[name="${input.name}"]`);
        if (!hiddenInput) {
          hiddenInput = document.createElement('input');
          hiddenInput.type = 'hidden';
          hiddenInput.name = input.name;
          mainForm.appendChild(hiddenInput);
        }
        hiddenInput.value = input.value;
      } else {
        // Remove hidden input if value is empty
        const hiddenInput = mainForm.querySelector(`input[name="${input.name}"]`);
        if (hiddenInput && hiddenInput.type === 'hidden') {
          hiddenInput.remove();
        }
      }
    });
    
    // Submit form manually to update the page
    mainForm.submit();
    
    closeFilterModal();
  }

  function clearAllFilters() {
    const form = document.getElementById('modalFilterForm');
    const mainForm = document.querySelector('.rvo-form');
    
    // Clear modal form
    form.querySelectorAll('select, input[type="date"]').forEach(input => {
      input.value = '';
    });
    
    // Remove all hidden filter inputs from main form
    mainForm.querySelectorAll('input[type="hidden"]').forEach(input => {
      input.remove();
    });
    
    // Clear visible inputs in main form
    mainForm.querySelectorAll('select, input[type="text"]').forEach(input => {
      input.value = '';
    });
    
    // Submit form to update the page
    mainForm.submit();
    
    closeFilterModal();
  }

  // Close modal when clicking outside
  document.getElementById('filterModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeFilterModal();
    }
  });

  // Close modal with escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && document.getElementById('filterModal').style.display === 'flex') {
      closeFilterModal();
    }
  });
</script>