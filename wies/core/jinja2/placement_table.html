{% extends "base.html" %}
{% block extra_head %}
  <link rel="stylesheet" href="{{ static('css/placements.css') }}">
  <link rel="stylesheet"
        href="{{ static('css/placement_filter_sidebar.css') }}">
  <link rel="stylesheet" href="{{ static('css/side_panel.css') }}">
  <script src="{{ static('js/placement_filter_sidebar.js') }}"></script>
  <script src="{{ static('js/dialog.js') }}"></script>
  <script src="{{ static('js/side_panel.js') }}"></script>
{% endblock extra_head %}
{% block sidebar %}
  <form class="rvo-form filter-sidebar-form"
        hx-get="{{ url('placements') }}"
        hx-target="#filter-and-table-container"
        hx-push-url="true"
        hx-trigger="change,input delay:500ms from:[data-filter-input]"
        hx-include="[data-filter-input]">
    <!-- Behoud filters state in HTMX requests -->
    {% if request.GET.get('filters') %}
      <input type="hidden"
             name="filters"
             value="{{ request.GET.get('filters') }}"
             data-filter-input />
    {% endif %}
    <!-- Filter Fields -->
    <div class="app-sidebar__content">
      <div class="rvo-layout-column rvo-layout-gap--md">
        {% for filter_group in filter_groups %}
          {% if filter_group.type == 'select' %}
            <c-select-field label="{{ filter_group.label }}" name="{{ filter_group.name }}" id="filter-{{ filter_group.name }}" data-filter-input :options="filter_group.options" value="{{ filter_group.value }}" />
          {% elif filter_group.type == 'date_range' %}
            <div class="filter-sidebar-date-range">
              <span class="rvo-label filter-sidebar-label">{{ filter_group.label }}</span>
              <div class="rvo-layout-column rvo-layout-gap--sm">
                <div class="utrecht-form-field rvo-form-field">
                  <div class="rvo-form-field__label">
                    <label for="filter-{{ filter_group.name }}-from"
                           class="rvo-label utrecht-form-label">{{ filter_group.from_label }}</label>
                  </div>
                  <input type="date"
                         id="filter-{{ filter_group.name }}-from"
                         class="utrecht-textbox utrecht-textbox--html-input"
                         data-require-both="{%- if filter_group.require_both -%}true{%- else -%}false{%- endif -%}"
                         data-combined-name="{{ filter_group.name }}"
                         data-pair-id="filter-{{ filter_group.name }}-to"
                         value="{%- if active_filters.get(filter_group.name) -%}{{ active_filters.get(filter_group.name).from.strftime('%Y-%m-%d') }}{%- endif -%}" />
                </div>
                <div class="utrecht-form-field rvo-form-field">
                  <div class="rvo-form-field__label">
                    <label for="filter-{{ filter_group.name }}-to"
                           class="rvo-label utrecht-form-label">{{ filter_group.to_label }}</label>
                  </div>
                  <input type="date"
                         id="filter-{{ filter_group.name }}-to"
                         class="utrecht-textbox utrecht-textbox--html-input"
                         data-require-both="{%- if filter_group.require_both -%}true{%- else -%}false{%- endif -%}"
                         data-combined-name="{{ filter_group.name }}"
                         data-pair-id="filter-{{ filter_group.name }}-from"
                         value="{%- if active_filters.get(filter_group.name) -%}{{ active_filters.get(filter_group.name).to.strftime('%Y-%m-%d') }}{%- endif -%}" />
                </div>
              </div>
            </div>
            {% if filter_group.require_both %}
              <!-- Hidden input managed by JS - only submitted when both dates are filled -->
              <input type="hidden"
                     id="filter-{{ filter_group.name }}-combined"
                     name="{{ filter_group.name }}"
                     data-filter-input />
              <div id="{{ filter_group.name }}-validation-message"
                   class="date-range-validation-message">
                Beide datums zijn vereist voor een geldige periode filter.
              </div>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </form>
{% endblock sidebar %}
{% block content %}
  {% include "parts/filter_and_table_container.html" %}
{% endblock content %}
{% block panel %}
  <div id="side_panel-container">
    {% if panel_data %}
      {% set colleague = panel_data.colleague %}
      {% set assignment = panel_data.assignment %}
      {% include "parts/side_panel.html" %}
    {% endif %}
  </div>
{% endblock panel %}
