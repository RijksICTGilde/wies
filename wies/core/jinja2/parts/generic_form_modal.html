<div class="modal-overlay" style="display: flex;">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="utrecht-heading-2">{{ modal_title }}</h2>
      <button type="button" class="modal-close" onclick="document.getElementById('{{ modal_element_id }}').innerHTML=''; document.body.style.overflow='auto';">&times;</button>
    </div>

    <form method="post" action="{{ form_post_url }}" hx-post="{{ form_post_url }}" hx-target="#{{ target_element_id }}">
      {{ get_csrf_hidden_input(request) }}

      <div class="modal-body">
        {{ content }}
      </div>

      <div class="modal-footer">
        <div style="display: flex; gap: 0.5rem;">
          <c-button kind="{% if warning_modal %}warning-subtle{% else %}secondary{% endif %}" type="button" @click="document.getElementById('{{ modal_element_id }}').innerHTML=''; document.body.style.overflow='auto';">
            Annuleren
          </c-button>
          {% if delete_url %}
          <c-button kind="warning" type="button" id="delete-button" data-delete-url="{{ delete_url }}" data-confirm-message="{{ delete_confirm_message|default('Weet je zeker dat je dit wilt verwijderen?') }}" data-success-action="{{ delete_success_action|default('location.reload()') }}">
            Verwijderen
          </c-button>
          {% endif %}
        </div>
        <c-button kind="{% if warning_modal %}warning{% else %}primary{% endif %}" type="submit">
          {{ form_button_label }}
        </c-button>
      </div>
    </form>
  </div>
</div>

<script>
{% if delete_url %}
document.getElementById('delete-button').addEventListener('click', function() {
    const confirmMessage = this.dataset.confirmMessage;
    const deleteUrl = this.dataset.deleteUrl;
    const successAction = this.dataset.successAction;
    
    if (confirm(confirmMessage)) {
        fetch(deleteUrl, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ get_csrf_token(request) }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => {
            if (response.ok) {
                eval(successAction);
            } else {
                alert('Er is een fout opgetreden bij het verwijderen.');
            }
        })
        .catch(error => {
            alert('Er is een fout opgetreden bij het verwijderen.');
        });
    }
});
{% endif %}
</script>
